os: linux
dist: xenial

language: shell
services:
  - docker

_shared_job: &shared_job
  script:
    - docker build -t ${IMAGE_NAME}:travis-ci-test ${IMAGE_DIR}


jobs:
  include:
    - name: "Build PyTorch CIFAR10 ResNet-20"
      env:
        - IMAGE_NAME=pytorch-cifar10-resnet20-all-reduce
        - IMAGE_DIR=./pytorch/imagerecognition/cifar10-resnet20-all-reduce
      <<: *shared_job

    - name: "Build PyTorch CIFAR10 ResNet-20 (DDP)"
      env:
        - IMAGE_NAME=pytorch-cifar10-resnet20-ddp
        - IMAGE_DIR=./pytorch/imagerecognition/cifar10-resnet20-distributed-data-parallel
      <<: *shared_job

    - name: "Build PyTorch Epsilon Logistic Regression"
      env:
        - IMAGE_NAME=pytorch-epsilon-logistic-regression-all-reduce
        - IMAGE_DIR=./pytorch/linearmodels/epsilon-logistic-regression-all-reduce
      <<: *shared_job

    - name: "Build PyTorch WMT16 GNMT"
      env:
        - IMAGE_NAME=pytorch-wmt16-gnmt-all-reduce
        - IMAGE_DIR=./pytorch/nlp/translation/wmt16-gnmt-all-reduce
      <<: *shared_job

    - name: "Build PyTorch WMT17 Transformer"
      env:
        - IMAGE_NAME=pytorch-wmt17-transformer-all-reduce
        - IMAGE_DIR=./pytorch/nlp/translation/wmt17-transformer-all-reduce
      <<: *shared_job

    - name: "Build PyTorch Wikitext2 RNN"
      env:
        - IMAGE_NAME=pytorch-openmpi-wikitext2-rnn-lm
        - IMAGE_DIR=./pytorch/nlp/language-modeling/openmpi-wikitext2-rnn-lm
      <<: *shared_job

    - name: "Build Tensorflow base"
      env:
        - IMAGE_NAME=mlbench-tensorflow-base
        - IMAGE_DIR=./tensorflow/base/
      <<: *shared_job

    - name: "Build Tensorflow CIFAR10 ResNet-20"
      env:
        - IMAGE_NAME=tensorflow-openmpi-cifar10-resnet20-all-reduce
        - IMAGE_DIR=./tensorflow/imagerecognition/openmpi-cifar10-resnet20-all-reduce
      <<: *shared_job